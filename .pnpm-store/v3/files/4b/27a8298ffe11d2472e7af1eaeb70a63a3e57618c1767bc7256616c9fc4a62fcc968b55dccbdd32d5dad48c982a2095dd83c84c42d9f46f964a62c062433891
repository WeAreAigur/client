import C,{Fragment as ne,createContext as X,useContext as Y,useMemo as M,useReducer as ae,useRef as $}from"react";import{render as _,Features as Z,forwardRefWithAs as U}from'../../utils/render.js';import{useId as ee}from'../../hooks/use-id.js';import{match as H}from'../../utils/match.js';import{Keys as P}from'../../components/keyboard.js';import{focusIn as F,Focus as g,sortByDomNode as O,FocusResult as G}from'../../utils/focus-management.js';import{useIsoMorphicEffect as j}from'../../hooks/use-iso-morphic-effect.js';import{useSyncRefs as k}from'../../hooks/use-sync-refs.js';import{useResolveButtonType as le}from'../../hooks/use-resolve-button-type.js';import{useLatestValue as q}from'../../hooks/use-latest-value.js';import{FocusSentinel as oe}from'../../internal/focus-sentinel.js';import{useEvent as S}from'../../hooks/use-event.js';import{microTask as se}from'../../utils/micro-task.js';import{Hidden as ie}from'../../internal/hidden.js';import{getOwnerDocument as ue}from'../../utils/owner.js';import{StableCollection as de,useStableCollectionIndex as te}from'../../utils/stable-collection.js';var ce=(r=>(r[r.Forwards=0]="Forwards",r[r.Backwards=1]="Backwards",r))(ce||{}),pe=(l=>(l[l.Less=-1]="Less",l[l.Equal=0]="Equal",l[l.Greater=1]="Greater",l))(pe||{}),fe=(n=>(n[n.SetSelectedIndex=0]="SetSelectedIndex",n[n.RegisterTab=1]="RegisterTab",n[n.UnregisterTab=2]="UnregisterTab",n[n.RegisterPanel=3]="RegisterPanel",n[n.UnregisterPanel=4]="UnregisterPanel",n))(fe||{});let be={[0](e,t){var T;let r=O(e.tabs,o=>o.current),l=O(e.panels,o=>o.current),i=r.filter(o=>{var R;return!((R=o.current)!=null&&R.hasAttribute("disabled"))}),n={...e,tabs:r,panels:l};if(t.index<0||t.index>r.length-1){let o=H(Math.sign(t.index-e.selectedIndex),{[-1]:()=>1,[0]:()=>H(Math.sign(t.index),{[-1]:()=>0,[0]:()=>0,[1]:()=>1}),[1]:()=>0});return i.length===0?n:{...n,selectedIndex:H(o,{[0]:()=>r.indexOf(i[0]),[1]:()=>r.indexOf(i[i.length-1])})}}let c=r.slice(0,t.index),x=[...r.slice(t.index),...c].find(o=>i.includes(o));if(!x)return n;let f=(T=r.indexOf(x))!=null?T:e.selectedIndex;return f===-1&&(f=e.selectedIndex),{...n,selectedIndex:f}},[1](e,t){var n;if(e.tabs.includes(t.tab))return e;let r=e.tabs[e.selectedIndex],l=O([...e.tabs,t.tab],c=>c.current),i=(n=l.indexOf(r))!=null?n:e.selectedIndex;return i===-1&&(i=e.selectedIndex),{...e,tabs:l,selectedIndex:i}},[2](e,t){return{...e,tabs:e.tabs.filter(r=>r!==t.tab)}},[3](e,t){return e.panels.includes(t.panel)?e:{...e,panels:O([...e.panels,t.panel],r=>r.current)}},[4](e,t){return{...e,panels:e.panels.filter(r=>r!==t.panel)}}},z=X(null);z.displayName="TabsDataContext";function v(e){let t=Y(z);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,v),r}return t}let V=X(null);V.displayName="TabsActionsContext";function J(e){let t=Y(V);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,J),r}return t}function Te(e,t){return H(t.type,be,e,t)}let me=ne,Pe=U(function(t,r){let{defaultIndex:l=0,vertical:i=!1,manual:n=!1,onChange:c,selectedIndex:d=null,...x}=t;const f=i?"vertical":"horizontal",T=n?"manual":"auto";let o=d!==null,R=k(r),[s,p]=ae(Te,{selectedIndex:d!=null?d:l,tabs:[],panels:[]}),y=M(()=>({selectedIndex:s.selectedIndex}),[s.selectedIndex]),m=q(c||(()=>{})),A=q(s.tabs),E=M(()=>({orientation:f,activation:T,...s}),[f,T,s]),h=S(u=>(p({type:1,tab:u}),()=>p({type:2,tab:u}))),L=S(u=>(p({type:3,panel:u}),()=>p({type:4,panel:u}))),I=S(u=>{w.current!==u&&m.current(u),o||p({type:0,index:u})}),w=q(o?t.selectedIndex:s.selectedIndex),B=M(()=>({registerTab:h,registerPanel:L,change:I}),[]);j(()=>{p({type:0,index:d!=null?d:l})},[d]),j(()=>{if(w.current===void 0||s.tabs.length<=0)return;let u=O(s.tabs,a=>a.current);u.some((a,b)=>s.tabs[b]!==a)&&I(u.indexOf(s.tabs[w.current]))});let W={ref:R};return C.createElement(de,null,C.createElement(V.Provider,{value:B},C.createElement(z.Provider,{value:E},E.tabs.length<=0&&C.createElement(oe,{onFocus:()=>{var u,D;for(let a of A.current)if(((u=a.current)==null?void 0:u.tabIndex)===0)return(D=a.current)==null||D.focus(),!0;return!1}}),_({ourProps:W,theirProps:x,slot:y,defaultTag:me,name:"Tabs"}))))}),ge="div",xe=U(function(t,r){let{orientation:l,selectedIndex:i}=v("Tab.List"),n=k(r);return _({ourProps:{ref:n,role:"tablist","aria-orientation":l},theirProps:t,slot:{selectedIndex:i},defaultTag:ge,name:"Tabs.List"})}),ye="button",Ae=U(function(t,r){var u,D;let l=ee(),{id:i=`headlessui-tabs-tab-${l}`,...n}=t,{orientation:c,activation:d,selectedIndex:x,tabs:f,panels:T}=v("Tab"),o=J("Tab"),R=v("Tab"),s=$(null),p=k(s,r);j(()=>o.registerTab(s),[o,s]);let y=te("tabs"),m=f.indexOf(s);m===-1&&(m=y);let A=m===x,E=S(a=>{var N;let b=a();if(b===G.Success&&d==="auto"){let K=(N=ue(s))==null?void 0:N.activeElement,Q=R.tabs.findIndex(re=>re.current===K);Q!==-1&&o.change(Q)}return b}),h=S(a=>{let b=f.map(K=>K.current).filter(Boolean);if(a.key===P.Space||a.key===P.Enter){a.preventDefault(),a.stopPropagation(),o.change(m);return}switch(a.key){case P.Home:case P.PageUp:return a.preventDefault(),a.stopPropagation(),E(()=>F(b,g.First));case P.End:case P.PageDown:return a.preventDefault(),a.stopPropagation(),E(()=>F(b,g.Last))}if(E(()=>H(c,{vertical(){return a.key===P.ArrowUp?F(b,g.Previous|g.WrapAround):a.key===P.ArrowDown?F(b,g.Next|g.WrapAround):G.Error},horizontal(){return a.key===P.ArrowLeft?F(b,g.Previous|g.WrapAround):a.key===P.ArrowRight?F(b,g.Next|g.WrapAround):G.Error}}))===G.Success)return a.preventDefault()}),L=$(!1),I=S(()=>{var a;L.current||(L.current=!0,(a=s.current)==null||a.focus(),o.change(m),se(()=>{L.current=!1}))}),w=S(a=>{a.preventDefault()}),B=M(()=>({selected:A}),[A]),W={ref:p,onKeyDown:h,onMouseDown:w,onClick:I,id:i,role:"tab",type:le(t,s),"aria-controls":(D=(u=T[m])==null?void 0:u.current)==null?void 0:D.id,"aria-selected":A,tabIndex:A?0:-1};return _({ourProps:W,theirProps:n,slot:B,defaultTag:ye,name:"Tabs.Tab"})}),Ee="div",Re=U(function(t,r){let{selectedIndex:l}=v("Tab.Panels"),i=k(r),n=M(()=>({selectedIndex:l}),[l]);return _({ourProps:{ref:i},theirProps:t,slot:n,defaultTag:Ee,name:"Tabs.Panels"})}),Le="div",Ie=Z.RenderStrategy|Z.Static,Se=U(function(t,r){var E,h,L,I;let l=ee(),{id:i=`headlessui-tabs-panel-${l}`,tabIndex:n=0,...c}=t,{selectedIndex:d,tabs:x,panels:f}=v("Tab.Panel"),T=J("Tab.Panel"),o=$(null),R=k(o,r);j(()=>T.registerPanel(o),[T,o]);let s=te("panels"),p=f.indexOf(o);p===-1&&(p=s);let y=p===d,m=M(()=>({selected:y}),[y]),A={ref:R,id:i,role:"tabpanel","aria-labelledby":(h=(E=x[p])==null?void 0:E.current)==null?void 0:h.id,tabIndex:y?n:-1};return!y&&((L=c.unmount)!=null?L:!0)&&!((I=c.static)!=null&&I)?C.createElement(ie,{as:"span",...A}):_({ourProps:A,theirProps:c,slot:m,defaultTag:Le,features:Ie,visible:y,name:"Tabs.Panel"})}),Xe=Object.assign(Ae,{Group:Pe,List:xe,Panels:Re,Panel:Se});export{Xe as Tab};
